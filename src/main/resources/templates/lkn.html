<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="id">
<head>
    <meta charset="UTF-8"/>
    <title>Laporan Kunjungan</title>
    <style>
        @page { size: A4; margin: 8mm; }
        body { font-family: Arial, sans-serif; font-size: 8.5pt; margin: 0; color: #333; }
        .header { text-align: center; margin-bottom: 8px; border-bottom: 1px solid #000; padding-bottom: 5px; }
        .header h2 { margin: 0; font-size: 11pt; }

        .info-grid {
            display: grid; grid-template-columns: 60px 1fr 70px 1fr;
            gap: 2px 5px; margin-bottom: 10px; font-size: 8pt;
        }
        .label { font-weight: bold; }

        table { width: 100%; border-collapse: collapse; table-layout: fixed; }
        th, td { border: 1px solid #000; padding: 4px; vertical-align: top; word-wrap: break-word; }
        th { background: #f2f2f2; font-size: 7pt; text-transform: uppercase; }

        .col-no { width: 22px; text-align: center; }
        .col-tgl { width: 60px; text-align: center; }
        .col-amt { width: 80px; text-align: right; }
        .col-note { width: auto; }
        .col-sign { width: 50px; }

        .note-main { font-weight: bold; display: block; margin-bottom: 1px; }
        .sub-note { font-size: 7.5pt; color: #444; line-height: 1.1; }

        .footer { margin-top: 15px; display: flex; justify-content: space-between; }
        .sig-box { width: 180px; text-align: center; }
        .sig-space {
            border-top: 1px solid #000; width: 110px; margin: 30px auto 0; }
    </style>
</head>
<body>

<div class="header">
    <h2>LAPORAN KUNJUNGAN NASABAH</h2>
    <div style="font-size: 8.5pt;">Cabang Kaligondang</div>
</div>

<div class="info-grid" th:if="${not #lists.isEmpty(visits)}">
    <div class="label">Nama</div>
    <div th:text="': ' + ${visits[0].name}">-</div>

    <div class="label">No. SPK</div>
    <div th:text="': ' + ${visits[0].spk}">-</div>

    <div class="label">Alamat</div>
    <div th:text="': ' + ${visits[0].address}">-</div>

    <div class="label">Plafond</div>
    <div>
        : <span th:text="${visits[0].plafond != null ? #numbers.formatInteger(visits[0].plafond, 0, 'POINT') : '0'}">0</span>
    </div>
</div>

<table>
    <thead>
    <tr>
        <th class="col-no">No</th>
        <th class="col-tgl">Tanggal</th>
        <th class="col-amt">Tunggakan</th>
        <th class="col-note">Note / Janji Bayar / Reminder</th>
        <th class="col-sign">Ptg</th>
        <th class="col-sign">Pimp</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="v, stat : ${visits}">
        <td class="col-no" th:text="${stat.count}">1</td>
        <td class="col-tgl" th:text="${v.visitDate != null ? #temporals.format(v.visitDate, 'dd/MM/yy', 'Asia/Jakarta') : '-'}"></td>

        <td class="col-amt" th:with="totalRow=${(v.interest ?: 0) + (v.principal ?: 0)}">
            <span th:text="${#numbers.formatInteger(totalRow, 0, 'POINT')}">0</span>
        </td>

        <td class="col-note">
            <span class="note-main" th:text="${v.note}"></span>
            <div class="sub-note">
                <span th:if="${v.appointment != null}">
                    <strong>Janji Bayar:</strong> <span th:text="${#numbers.formatInteger(v.appointment, 0, 'POINT')}"></span>
                </span>
                <span th:if="${v.reminderDate != null}" th:text="' | Reminder: ' + ${#temporals.format(v.reminderDate, 'dd/MM/yy')}"></span>
            </div>
        </td>
        <td></td>
        <td></td>
    </tr>
    </tbody>
</table>

<div class="footer">
    <div class="sig-box">
        <p>Petugas Lapangan,</p>
        <div class="sig-space"></div>
    </div>
    <div class="sig-box">
        <p>Pimpinan Cabang,</p>
        <div class="sig-space"></div>
    </div>
</div>

</body>
</html>